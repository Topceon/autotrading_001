import create_position as cp
import market_actions as ma

LOT_SIZE = {'1000PEPEUSDT': 0, 'WLDUSDT': 0}
PRICE_PRECISION = {'1000PEPEUSDT': 7, 'WLDUSDT': 4}
DEP = 10


def average(val):
    prices = []
    for i in val:
        prices.append(float(i[4]))
    prices = prices[:-20:-5]
    return sum(prices) / len(prices)


def close_orders():
    pass


def create_position(key, val, side):
    a = average(val)
    price = round(a + side * a / 100, PRICE_PRECISION[key])
    quantity = round(DEP / price + 1, LOT_SIZE[key])
    return {'symbol': key,
            'side': 'BUY' if side < 0 else 'SELL',
            'type': 'LIMIT',
            'price': price,
            'quantity': quantity}


def create_positions(key, val, balance):
    orders = []
    cp.create_position({'symbol': key, 'type': 'CancelOrder'})
    if balance[key] <= 0:
        orders.append(create_position(key, val, 2.6))
    if balance[key] >= 0:
        orders.append(create_position(key, val, -2.6))
    orders.append(create_position(key, val, 1.6))
    orders.append(create_position(key, val, -1.6))
    return orders


def strategy(data, balance):
    orders = []
    for key, val in data.items():
        a = create_positions(key, val, balance)
        for i in a:
            orders.append(i)
    return orders


if __name__ == '__main__':
    data = {'1000PEPEUSDT': [
        [1712383620000, '0.0067509', '0.0067556', '0.0067468', '0.0067509', '36278065', 1712383679999, '244895.6272289',
         623, '11384583', '76869.3090594', '0'],
        [1712383680000, '0.0067510', '0.0067535', '0.0067464', '0.0067501', '20166196', 1712383739999, '136108.3756793',
         559, '12059605', '81396.4632626', '0'],
        [1712383740000, '0.0067500', '0.0067529', '0.0067476', '0.0067489', '20364681', 1712383799999, '137462.7356920',
         650, '12402815', '83724.4964356', '0'],
        [1712383800000, '0.0067488', '0.0067513', '0.0067425', '0.0067485', '34242768', 1712383859999, '231017.0009876',
         692, '18271359', '123264.4279995', '0'],
        [1712383860000, '0.0067497', '0.0067932', '0.0067431', '0.0067844', '317389904', 1712383919999,
         '2148652.9458853', 4021, '233560161', '1580707.7608957', '0'],
        [1712383920000, '0.0067839', '0.0067994', '0.0067668', '0.0067877', '162528438', 1712383979999,
         '1102694.4413059', 3040, '87028336', '590514.0768333', '0'],
        [1712383980000, '0.0067879', '0.0068019', '0.0067799', '0.0067935', '93124882', 1712384039999, '632426.4954871',
         1770, '51879542', '352258.4431780', '0'],
        [1712384040000, '0.0067935', '0.0067941', '0.0067723', '0.0067775', '114218378', 1712384099999,
         '774815.4929657', 1783, '33489910', '227156.1703890', '0'],
        [1712384100000, '0.0067769', '0.0067891', '0.0067698', '0.0067731', '55860516', 1712384159999, '378596.7653842',
         1162, '34628632', '234721.6440878', '0'],
        [1712384160000, '0.0067730', '0.0067849', '0.0067680', '0.0067811', '32079360', 1712384219999, '217288.9633971',
         811, '22933053', '155318.2508847', '0'],
        [1712384220000, '0.0067810', '0.0067849', '0.0067760', '0.0067795', '29747764', 1712384279999, '201698.2278414',
         647, '15130241', '102584.0275936', '0'],
        [1712384280000, '0.0067795', '0.0067894', '0.0067758', '0.0067856', '23347532', 1712384339999, '158412.8176553',
         837, '15334892', '104045.4589760', '0'],
        [1712384340000, '0.0067855', '0.0067947', '0.0067818', '0.0067877', '46098799', 1712384399999, '312989.6022635',
         997, '18921123', '128446.2142082', '0'],
        [1712384400000, '0.0067877', '0.0067878', '0.0067841', '0.0067842', '13984280', 1712384459999, '94896.7095174',
         462, '6869874', '46619.9757937', '0'],
        [1712384460000, '0.0067842', '0.0067863', '0.0067651', '0.0067671', '47746110', 1712384519999, '323560.6327998',
         1060, '16047478', '108715.5822709', '0'],
        [1712384520000, '0.0067675', '0.0067675', '0.0067582', '0.0067665', '28669659', 1712384579999, '193863.7974590',
         881, '12345827', '83474.2104026', '0'],
        [1712384580000, '0.0067665', '0.0067665', '0.0067550', '0.0067566', '29747308', 1712384639999, '201046.0055490',
         710, '8864154', '59921.3273111', '0'],
        [1712384640000, '0.0067561', '0.0067592', '0.0067521', '0.0067537', '16745243', 1712384699999, '113114.6077228',
         621, '9583911', '64740.4317212', '0'],
        [1712384700000, '0.0067536', '0.0067757', '0.0067520', '0.0067737', '24518951', 1712384759999, '165754.8502131',
         850, '19782598', '133720.2770196', '0'],
        [1712384760000, '0.0067732', '0.0067760', '0.0067661', '0.0067740', '19870424', 1712384819999, '134553.0823880',
         828, '10573574', '71603.5809963', '0'],
        [1712384820000, '0.0067743', '0.0067783', '0.0067742', '0.0067755', '9345387', 1712384879999, '63327.7274634',
         483, '4647664', '31494.3757664', '0'],
        [1712384880000, '0.0067754', '0.0067754', '0.0067706', '0.0067717', '8785979', 1712384939999, '59495.5315000',
         371, '3170279', '21467.4862864', '0'],
        [1712384940000, '0.0067717', '0.0067757', '0.0067700', '0.0067756', '10010376', 1712384999999, '67788.5961739',
         350, '4297504', '29103.3552371', '0'],
        [1712385000000, '0.0067756', '0.0067757', '0.0067578', '0.0067578', '21264592', 1712385059999, '143906.0022438',
         729, '8683349', '58773.2195867', '0'],
        [1712385060000, '0.0067578', '0.0067652', '0.0067525', '0.0067629', '33285517', 1712385119999, '224916.1892131',
         731, '22131271', '149559.2566852', '0'],
        [1712385120000, '0.0067627', '0.0067627', '0.0067542', '0.0067564', '26798638', 1712385179999, '181130.6902494',
         576, '18465549', '124811.4080023', '0'],
        [1712385180000, '0.0067564', '0.0067642', '0.0067548', '0.0067641', '38456144', 1712385239999, '259964.2538723',
         557, '30400045', '205515.0837235', '0'],
        [1712385240000, '0.0067640', '0.0067679', '0.0067572', '0.0067636', '33309935', 1712385299999, '225272.4418766',
         704, '20499415', '138639.8390283', '0'],
        [1712385300000, '0.0067636', '0.0067680', '0.0067613', '0.0067679', '28448258', 1712385359999, '192454.0157575',
         442, '19486270', '131830.6482448', '0'],
        [1712385360000, '0.0067679', '0.0067679', '0.0067621', '0.0067642', '17968364', 1712385419999, '121540.3888958',
         463, '8358773', '56540.4657245', '0'],
        [1712385420000, '0.0067641', '0.0067674', '0.0067533', '0.0067609', '54334309', 1712385479999, '367366.5064525',
         1284, '31946175', '216001.5421969', '0'],
        [1712385480000, '0.0067610', '0.0067611', '0.0067544', '0.0067555', '15617163', 1712385539999, '105541.1588279',
         582, '5172701', '34958.8762724', '0'],
        [1712385540000, '0.0067554', '0.0067599', '0.0067512', '0.0067569', '25362787', 1712385599999, '171335.7406088',
         566, '17105037', '115550.9923440', '0'],
        [1712385600000, '0.0067568', '0.0067569', '0.0067500', '0.0067532', '35329950', 1712385659999, '238568.6541049',
         865, '12457410', '84126.2372460', '0'],
        [1712385660000, '0.0067533', '0.0067570', '0.0067504', '0.0067541', '23468147', 1712385719999, '158495.3034457',
         575, '7795209', '52651.3117204', '0'],
        [1712385720000, '0.0067541', '0.0067559', '0.0067522', '0.0067527', '13118447', 1712385779999, '88598.8482038',
         422, '4352306', '29394.4212318', '0'],
        [1712385780000, '0.0067529', '0.0067632', '0.0067529', '0.0067627', '6984223', 1712385839999, '47208.5568747',
         379, '4673013', '31585.3944325', '0'],
        [1712385840000, '0.0067626', '0.0067733', '0.0067613', '0.0067645', '29605225', 1712385899999, '200371.8057072',
         1064, '16754431', '113392.8397513', '0'],
        [1712385900000, '0.0067644', '0.0067771', '0.0067568', '0.0067771', '41363068', 1712385959999, '279837.6210335',
         1420, '26587636', '179896.8897140', '0'],
        [1712385960000, '0.0067770', '0.0067780', '0.0067703', '0.0067716', '11162651', 1712386019999, '75602.5840751',
         479, '3755730', '25435.5640967', '0'],
        [1712386020000, '0.0067715', '0.0067788', '0.0067694', '0.0067768', '24919089', 1712386079999, '168788.8159573',
         928, '15740413', '106631.5117303', '0'],
        [1712386080000, '0.0067768', '0.0067841', '0.0067755', '0.0067835', '36640808', 1712386139999, '248461.8490562',
         930, '23910949', '162143.3669350', '0'],
        [1712386140000, '0.0067838', '0.0067972', '0.0067831', '0.0067883', '42256365', 1712386199999, '286908.6651263',
         1366, '21552208', '146328.0761144', '0'],
        [1712386200000, '0.0067889', '0.0068011', '0.0067875', '0.0067993', '26961034', 1712386259999, '183232.8047379',
         866, '16518765', '112264.6481517', '0'],
        [1712386260000, '0.0067993', '0.0067993', '0.0067827', '0.0067892', '35509605', 1712386319999, '241076.3034656',
         1090, '10220441', '69375.1187191', '0'],
        [1712386320000, '0.0067893', '0.0067893', '0.0067762', '0.0067807', '29072714', 1712386379999, '197275.4177434',
         895, '9213075', '62507.7901907', '0'],
        [1712386380000, '0.0067807', '0.0067970', '0.0067796', '0.0067968', '18644160', 1712386439999, '126547.4071254',
         677, '14554206', '98789.7058663', '0'],
        [1712386440000, '0.0067968', '0.0067970', '0.0067905', '0.0067956', '14402116', 1712386499999, '97857.1416359',
         536, '7336409', '49846.5439956', '0'],
        [1712386500000, '0.0067955', '0.0068000', '0.0067922', '0.0067993', '18069957', 1712386559999, '122819.2853643',
         660, '7868505', '53488.0746753', '0'],
        [1712386560000, '0.0067993', '0.0068030', '0.0067962', '0.0067994', '18244884', 1712386619999, '124064.9202445',
         471, '11519622', '78338.8551183', '0']], 'WLDUSDT': [
        [1712383620000, '7.1309000', '7.1319000', '7.1180000', '7.1208000', '16227', 1712383679999, '115628.7553000',
         523, '4319', '30776.8190000', '0'],
        [1712383680000, '7.1205000', '7.1225000', '7.1178000', '7.1191000', '11891', 1712383739999, '84664.1012000',
         287, '5067', '36079.3266000', '0'],
        [1712383740000, '7.1192000', '7.1413000', '7.1187000', '7.1387000', '32240', 1712383799999, '230064.7564000',
         668, '24002', '171273.7221000', '0'],
        [1712383800000, '7.1383000', '7.1406000', '7.1262000', '7.1358000', '18696', 1712383859999, '133389.3236000',
         749, '10193', '72732.9794000', '0'],
        [1712383860000, '7.1358000', '7.1359000', '7.1145000', '7.1243000', '25022', 1712383919999, '178225.1894000',
         754, '11394', '81144.9676000', '0'],
        [1712383920000, '7.1239000', '7.1295000', '7.1128000', '7.1147000', '12280', 1712383979999, '87466.7015000',
         521, '6683', '47615.2834000', '0'],
        [1712383980000, '7.1148000', '7.1228000', '7.1125000', '7.1218000', '7049', 1712384039999, '50167.2037000', 369,
         '4042', '28765.2688000', '0'],
        [1712384040000, '7.1216000', '7.1317000', '7.1169000', '7.1172000', '16055', 1712384099999, '114370.9211000',
         555, '6822', '48604.1205000', '0'],
        [1712384100000, '7.1171000', '7.1248000', '7.1118000', '7.1187000', '16914', 1712384159999, '120374.8048000',
         557, '10532', '74942.1480000', '0'],
        [1712384160000, '7.1187000', '7.1340000', '7.1139000', '7.1324000', '19412', 1712384219999, '138270.0145000',
         708, '9938', '70802.9365000', '0'],
        [1712384220000, '7.1324000', '7.1507000', '7.1324000', '7.1459000', '39884', 1712384279999, '284873.6690000',
         1046, '27115', '193672.6282000', '0'],
        [1712384280000, '7.1460000', '7.1522000', '7.1409000', '7.1445000', '29375', 1712384339999, '209962.9574000',
         725, '9525', '68083.1540000', '0'],
        [1712384340000, '7.1435000', '7.1455000', '7.1359000', '7.1377000', '16062', 1712384399999, '114705.0949000',
         527, '6441', '46004.8431000', '0'],
        [1712384400000, '7.1378000', '7.1440000', '7.1320000', '7.1320000', '14140', 1712384459999, '100952.5009000',
         491, '5808', '41470.9220000', '0'],
        [1712384460000, '7.1320000', '7.1320000', '7.1100000', '7.1104000', '27819', 1712384519999, '197974.4058000',
         841, '6927', '49311.6891000', '0'],
        [1712384520000, '7.1104000', '7.1106000', '7.0997000', '7.1085000', '24887', 1712384579999, '176808.6298000',
         692, '6414', '45571.2829000', '0'],
        [1712384580000, '7.1091000', '7.1091000', '7.0984000', '7.0996000', '13454', 1712384639999, '95538.1432000',
         468, '2893', '20543.5180000', '0'],
        [1712384640000, '7.0992000', '7.1152000', '7.0943000', '7.1142000', '13528', 1712384699999, '96125.1966000',
         500, '9097', '64656.2540000', '0'],
        [1712384700000, '7.1142000', '7.1249000', '7.1098000', '7.1219000', '13918', 1712384759999, '99046.0650000',
         632, '8400', '59776.2003000', '0'],
        [1712384760000, '7.1231000', '7.1236000', '7.1096000', '7.1151000', '16762', 1712384819999, '119291.8453000',
         552, '4727', '33634.2163000', '0'],
        [1712384820000, '7.1152000', '7.1187000', '7.1126000', '7.1163000', '5133', 1712384879999, '36520.7274000', 252,
         '1924', '13690.2225000', '0'],
        [1712384880000, '7.1158000', '7.1158000', '7.1075000', '7.1093000', '14384', 1712384939999, '102302.8691000',
         516, '9966', '70887.1810000', '0'],
        [1712384940000, '7.1101000', '7.1169000', '7.1045000', '7.1169000', '34775', 1712384999999, '247239.3122000',
         721, '14866', '105724.5832000', '0'],
        [1712385000000, '7.1170000', '7.1170000', '7.0993000', '7.0993000', '12967', 1712385059999, '92147.8624000',
         463, '4743', '33703.5401000', '0'],
        [1712385060000, '7.0991000', '7.1096000', '7.0876000', '7.1083000', '30125', 1712385119999, '213818.7980000',
         992, '14456', '102637.9706000', '0'],
        [1712385120000, '7.1061000', '7.1061000', '7.0869000', '7.0876000', '10703', 1712385179999, '75947.4318000',
         486, '2551', '18101.6017000', '0'],
        [1712385180000, '7.0877000', '7.0990000', '7.0835000', '7.0959000', '14468', 1712385239999, '102567.9400000',
         553, '6839', '48496.9371000', '0'],
        [1712385240000, '7.0965000', '7.1058000', '7.0823000', '7.1045000', '44132', 1712385299999, '312929.5006000',
         976, '18725', '132815.5646000', '0'],
        [1712385300000, '7.1045000', '7.1179000', '7.1033000', '7.1177000', '17122', 1712385359999, '121741.8926000',
         650, '10862', '77247.0230000', '0'],
        [1712385360000, '7.1176000', '7.1277000', '7.1128000', '7.1207000', '26662', 1712385419999, '189901.3699000',
         810, '15766', '112296.1518000', '0'],
        [1712385420000, '7.1206000', '7.1206000', '7.0995000', '7.1054000', '18818', 1712385479999, '133821.4300000',
         633, '5744', '40811.3880000', '0'],
        [1712385480000, '7.1052000', '7.1052000', '7.0955000', '7.0970000', '15122', 1712385539999, '107352.6415000',
         425, '3751', '26626.3866000', '0'],
        [1712385540000, '7.0969000', '7.1060000', '7.0950000', '7.1041000', '8577', 1712385599999, '60892.8532000', 320,
         '6417', '45554.4174000', '0'],
        [1712385600000, '7.1043000', '7.1127000', '7.1011000', '7.1011000', '11473', 1712385659999, '81516.0305000',
         433, '3377', '23997.6398000', '0'],
        [1712385660000, '7.1008000', '7.1022000', '7.0947000', '7.0983000', '9664', 1712385719999, '68588.1964000', 329,
         '4276', '30351.9692000', '0'],
        [1712385720000, '7.0983000', '7.1038000', '7.0947000', '7.1038000', '4398', 1712385779999, '31217.9897000', 219,
         '2583', '18335.3031000', '0'],
        [1712385780000, '7.1039000', '7.1134000', '7.0957000', '7.0977000', '38848', 1712385839999, '276087.5582000',
         680, '10558', '75037.2540000', '0'],
        [1712385840000, '7.0976000', '7.0983000', '7.0925000', '7.0925000', '9178', 1712385899999, '65120.5026000', 310,
         '4192', '29746.8235000', '0'],
        [1712385900000, '7.0922000', '7.1002000', '7.0902000', '7.0994000', '20169', 1712385959999, '143109.5279000',
         546, '11173', '79277.4193000', '0'],
        [1712385960000, '7.0995000', '7.1035000', '7.0958000', '7.1016000', '10663', 1712386019999, '75718.2170000',
         347, '5837', '41444.4869000', '0'],
        [1712386020000, '7.1004000', '7.1004000', '7.0911000', '7.0913000', '3388', 1712386079999, '24041.9271000', 189,
         '1267', '8992.8861000', '0'],
        [1712386080000, '7.0914000', '7.1103000', '7.0914000', '7.1102000', '10431', 1712386139999, '74069.6566000',
         438, '6299', '44723.4974000', '0'],
        [1712386140000, '7.1103000', '7.1214000', '7.1058000', '7.1058000', '16429', 1712386199999, '116864.0433000',
         652, '6197', '44088.4342000', '0'],
        [1712386200000, '7.1067000', '7.1170000', '7.1059000', '7.1170000', '8114', 1712386259999, '57701.6881000', 393,
         '6345', '45122.3229000', '0'],
        [1712386260000, '7.1170000', '7.1170000', '7.0990000', '7.1040000', '6889', 1712386319999, '48951.9650000', 399,
         '3343', '23743.8383000', '0'],
        [1712386320000, '7.1028000', '7.1028000', '7.0950000', '7.0970000', '6044', 1712386379999, '42900.3472000', 261,
         '2063', '14641.2295000', '0'],
        [1712386380000, '7.0970000', '7.1089000', '7.0970000', '7.1035000', '16631', 1712386439999, '118168.7624000',
         443, '10712', '76112.3872000', '0'],
        [1712386440000, '7.1034000', '7.1035000', '7.0934000', '7.0973000', '8269', 1712386499999, '58674.0583000', 327,
         '2143', '15207.5012000', '0'],
        [1712386500000, '7.0966000', '7.1049000', '7.0897000', '7.1049000', '23068', 1712386559999, '163634.7163000',
         527, '6554', '46510.2540000', '0'],
        [1712386560000, '7.1049000', '7.1049000', '7.0975000', '7.1010000', '8273', 1712386619999, '58747.0096000', 267,
         '4006', '28447.5053000', '0']]}

    print(strategy(data))
    # cp.create_position({'symbol': '1000PEPEUSDT', 'side': 'BUY', 'type': 'LIMIT', 'price': 0.0065600, 'quantity': 1400})
